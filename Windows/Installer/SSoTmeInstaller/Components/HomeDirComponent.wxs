<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
  <Fragment>
    <!-- Embed the script as a binary resource -->
    <Binary Id="CreateSsotmeHomedirPs1" SourceFile="Scripts\CreateSsotmeHomedir.ps1" />

    <!-- CA to extract script to temp location and run it -->
    <CustomAction Id="SetHomeSsotmeScriptData"
                  Property="HomeSsotmeScript"
                  Value="&quot;[SystemFolder]WindowsPowerShell\v1.0\powershell.exe&quot; -NoProfile -ExecutionPolicy Bypass -Command &quot;$temp = [IO.Path]::GetTempPath() + 'CreateSsotmeHomedir.ps1'; [IO.File]::WriteAllBytes($temp, [System.Convert]::FromBase64String('[#CreateSsotmeHomedirPs1]')); &amp; powershell.exe -NoProfile -ExecutionPolicy Bypass -File $temp '[INSTALLFOLDER]'; Remove-Item -Path $temp -Force&quot;"
                  Execute="immediate" />

    <CustomAction Id="HomeSsotmeScript"
                  BinaryKey="WixCA"
                  DllEntry="WixQuietExec"
                  Execute="deferred"
                  Return="check"
                  Impersonate="no" />

    <InstallExecuteSequence>
      <Custom Action="SetHomeSsotmeScriptData" Before="InstallFinalize">NOT SSOTMEHOME_INSTALLED</Custom>
      <Custom Action="HomeSsotmeScript" After="SetHomeSsotmeScriptData">NOT SSOTMEHOME_INSTALLED</Custom>
    </InstallExecuteSequence>
  </Fragment>
</Wix>